---
title: "Exploratory Data Analysis"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: "hide"
---

```{r setup, include=FALSE}
library(tidyverse)
library(leaflet)
library(cowplot)

# set knitr defaults
knitr::opts_chunk$set(
  echo = TRUE, 
  message = FALSE, 
  warning = FALSE
)

# set theme defaults
theme_set(theme_minimal() + theme(legend.position = "bottom"))

# set color scale defaults
options(
    ggplot2.continuous.colour = "viridis",
    ggplot2.continuous.fill   = "viridis")

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete   = scale_fill_viridis_d
```

## Data Cleaning and Processing

(Describe the steps in data cleaning)

```{r}
tidy_df = 
  read.csv(
    "data/significant-volcanic-eruption-database.csv", 
    sep = ";", na.strings=c("", NA)) |>
  janitor::clean_names() |>
  select(
    -c(month, day, location, status, volcano_missing, volcano_missing_description, earthquakes_houses_damaged_description),
    -starts_with("total")
    ) |>
  mutate( # change flags to boolean
    flag_tsunami = case_match(flag_tsunami, "Tsunami"~ TRUE, NA ~ FALSE),
    flag_earthquake = case_match(flag_earthquake, "Earthquake"~ TRUE, NA ~ FALSE)
  ) |>
  separate(coordinates, into = c("lat", "long"), sep = ",") |>
  mutate(
    lat = as.numeric(lat), long = as.numeric(long)
  ) |>
  mutate_at(vars(ends_with('description')), ~ifelse(is.na(.), "None/No Record", .)) |>
  mutate( # shorten description
    volcano_deaths_description = case_match(
      volcano_deaths_description,
      "Very Many (~1001 or more deaths)" ~ "Very Many (~1001 or more)", 
      "Many (~101 to 1000 deaths)" ~ "Many (~101 to 1000)", 
      "Some (~51 to 100 deaths)" ~ "Some (~51 to 100)", 
      "Few (~1 to 50 deaths)" ~ "Few (~1 to 50)",
      "None/No Record" ~ "None/No Record"
    ),
    volcano_injuries_description = case_match(
      volcano_injuries_description,
      "Very Many (~1001 or more deaths)" ~ "Very Many (~1001 or more)", 
      "Many (~101 to 1000 deaths)" ~ "Many (~101 to 1000)", 
      "Some (~51 to 100 deaths)" ~ "Some (~51 to 100)", 
      "Few (~1 to 50 deaths)" ~ "Few (~1 to 50)",
      "None/No Record" ~ "None/No Record"
    ),
    volcano_damage_description = case_match(
      volcano_damage_description,
      "EXTREME (~$25 million or more)" ~ "EXTREME (~>=$25 million)", 
      "SEVERE (~>$5 to $24 million)" ~ "SEVERE (~$5 to $24 million)", 
      "MODERATE (~$1 to $5 million)" ~ "MODERATE (~$1 to $5 million)", 
      "LIMITED (roughly corresponding to less than $1 million)" ~ "LIMITED (~<$1 million)",
      "None/No Record" ~ "None/No Record"
    ),
    volcano_houses_destroyed_description = case_match(
      volcano_houses_destroyed_description,
      "Very Many (~1001 or more houses)" ~ "Very Many (~1001 or more)", 
      "Many (~101 to 1000 houses)" ~ "Many (~101 to 1000)", 
      "Some (~51 to 100 houses)" ~ "Some (~51 to 100)", 
      "Few (~1 to 50 houses)" ~ "Few (~1 to 50)",
      "None/No Record" ~ "None/No Record"
    )
  ) |>
  mutate( # change descriptions to factors w/ levels
    volcano_deaths_description = factor(volcano_deaths_description, levels = c("Very Many (~1001 or more)", "Many (~101 to 1000)", "Some (~51 to 100)", "Few (~1 to 50)", "None/No Record")),
    volcano_injuries_description = factor(volcano_injuries_description, levels = c("Very Many (~1001 or more)", "Many (~101 to 1000)", "Some (~51 to 100)", "Few (~1 to 50)", "None/No Record")),
    volcano_damage_description = factor(volcano_damage_description, levels = c("EXTREME (~>=$25 million)", "SEVERE (~$5 to $24 million)", "MODERATE (~$1 to $5 million)", "LIMITED (~<$1 million)", "None/No Record")),
    volcano_houses_destroyed_description = factor(volcano_houses_destroyed_description, levels = c("Very Many (~1001 or more)", "Many (~101 to 1000)", "Some (~51 to 100)", "Few (~1 to 50)", "None/No Record"))
  )

```

The final dataset used in the analysis has the following key variables:

* `year`: the year of eruption
* `flag_tsunami`: specifies whether there is a tsunami accompanying the volcanic eruption (1: with tsunami, 0: no tsunami)
* `flag_earthquake`: specifies whether there is an earthquake accompanying the volcanic eruption (1: with earthquake, 0: no earthquake)
* `volcano_name`: the name of the volcano
* `country`: the country where the volcano is located
* `elevation`: the elevation of the volcano
* `volcano_type`: the type of the volcano
* `volcanic_explosivity_index`          
* `volcano_deaths`                      
* `volcano_deaths_description`         
* `volcano_injuries`                    
* `volcano_injuries_description`       
* `volcano_damage_in_m`                
* `volcano_damage_description`         
* `volcano_houses_destroyed`             
* `volcano_houses_destroyed_description`
* `lat`                                 
* `long`


## Geographical Distribution of Volcanic Eruptions

First, we want to figure out which countries or regions are most prone to volcanic eruptions, so we make an interactive map to display the geographical distribution of volcanoes.

```{r}
geo_df = 
  tidy_df |>
  select(volcano_name, country, volcano_type, elevation, lat, long) |>
  group_by(volcano_name, country, volcano_type, elevation, lat, long) |>
  summarise(eruption_count = n())

geo_df |>
  filter(eruption_count >= 2) |>
  leaflet() |>
  addTiles() |>
  addProviderTiles(providers$CartoDB.Positron) |>
  addMarkers(lat = ~lat, 
             lng = ~long, 
             clusterOptions = markerClusterOptions(),
             label = ~paste(
               "Name: ", volcano_name, "<br>",
               "Country: ", country, "<br>",
               "Volcano Type: ", volcano_type, "<br>",
               "Elevation: ", elevation, "<br>",
               "Eruption Count: ", eruption_count) |> lapply(htmltools::HTML)) 
```

We can notice that most volcanoes are located at the edge of the continents. This pattern is a result of the tectonic plate boundaries where volcanic activity is often concentrated. 

```{r}
country1 =
  geo_df |>
  group_by(country)|>
  summarise(n = n()) |>
  arrange(desc(n)) |>
  head(5) |>
  ggplot(aes(x = reorder(country, -n), y = n, fill = country)) +
  geom_bar(stat = "identity", width = 0.6) +
  labs(title = "Top Five Countries with the Most Volcanoes",
       x = "Country",
       y = "Number of Volcanoes") 


country2 =
  geo_df |>
  group_by(country)|>
  summarise(n = sum(eruption_count)) |>
  arrange(desc(n)) |>
  head(5) |>
  ggplot(aes(x = reorder(country, -n), y = n, fill = country)) +
  geom_bar(stat = "identity", width = 0.6) +
  labs(title = "Top Five Countries with the Most Volcanic Eruptions",
       x = "Country",
       y = "Number of Eruptions") 

plot_grid(country1, country2, ncol = 1)
```

The top five countries with the most volcanoes are: Indonesia, Japan, United States, Papua New Guinea and Russia.  
The top five countries with the most volcanic eruptions are: Indonesia, Japan, Italy, Iceland and United States.

## The Factors Influencing Casualties and Property Losses Caused by Volcanic Activity(numeric)

In this section, we aim to explore the impact of various factors(the occurrence of tsunami and earthquake, the type of volcano and the volcanic explosivity index) on casualties and property losses resulting from volcanic eruptions.

### Tidy Data

```{r}
numeric_df = 
  tidy_df |> 
  select(year,flag_tsunami,flag_earthquake,
         volcano_type, volcanic_explosivity_index,
         volcano_injuries, volcano_deaths, volcano_damage_in_m, volcano_houses_destroyed) |>
  mutate(
    flag_tsunami = factor(flag_tsunami),
    flag_earthquake = factor(flag_earthquake),
    volcanic_explosivity_index = factor(volcanic_explosivity_index))
```

### Correlation between Tsunami Occurrence and Casualties and Property Losses Caused by Volcanic Activity

#### Plot 1-1: Correlation between Tsunami Occurrence and Injuries

```{r}
# flag_tsunami vs volcano_injuries box plot
numeric_df |>
  filter(!is.na(volcano_injuries)) |>
  ggplot(aes(x = flag_tsunami, y = volcano_injuries, group = flag_tsunami)) +
  geom_boxplot() +
  labs(title = "Correlation between Tsunami Occurrence and Injuries", x = "Tsunami Occurrence", y = "Injuries") +
  theme_minimal()
```

```{r}
# flag_tsunami vs volcano_injuries bar plot
numeric_df |>
  filter(!is.na(volcano_injuries)) |>
  group_by(flag_tsunami) |>
  summarize(total_injuries = mean(volcano_injuries)) |>
  ggplot(aes(x = flag_tsunami, y = total_injuries, fill = flag_tsunami)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Correlation between Tsunami Occurrence and Injuries", x = "Tsunami Occurrence", y = "Injuries") +
  theme_minimal() 
```

#### Plot 1-2: Correlation between Tsunami Occurrence and Deaths

```{r}
# flag_tsunami vs volcano_deaths box plot
numeric_df |>
  filter(!is.na(volcano_deaths)) |>
  ggplot(aes(x = flag_tsunami, y = volcano_deaths, group = flag_tsunami)) +
  geom_boxplot() +
  labs(title = "Correlation between Tsunami Occurrence and Deaths", x = "Tsunami Occurrence", y = "Deaths") +
  theme_minimal()
```

```{r}
# flag_tsunami vs volcano_deaths bar plot
numeric_df |>
  filter(!is.na(volcano_deaths)) |>
  group_by(flag_tsunami) |>
  summarize(total_deaths = mean(volcano_deaths)) |>
  ggplot(aes(x = flag_tsunami, y = total_deaths, fill = flag_tsunami)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title ="Correlation between Tsunami Occurrence and Deaths", x = "Tsunami Occurrence", y = "Deaths") +
  theme_minimal() 
```

#### Plot 1-3: Correlation between Tsunami Occurrence and Damage(money in million)

```{r}
# flag_tsunami vs damage box plot
numeric_df |>
  filter(!is.na(volcano_damage_in_m)) |>
  ggplot(aes(x = flag_tsunami, y = volcano_damage_in_m, group = flag_tsunami)) +
  geom_boxplot() +
  labs(title = "Correlation between Tsunami Occurrence and Damage(money in million)", x = "Tsunami Occurrence", y = "Damage(money in million)") +
  theme_minimal()
```

```{r}
# flag_tsunami vs damage bar plot
numeric_df |>
  filter(!is.na(volcano_damage_in_m)) |>
  group_by(flag_tsunami) |>
  summarize(total_damage = mean(volcano_damage_in_m)) |>
  ggplot(aes(x = flag_tsunami, y = total_damage, fill = flag_tsunami)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title ="Correlation between Tsunami Occurrence and Damage(money in million)", x = "Tsunami Occurrence", y = "Damage(money in million)") +
  theme_minimal() 
```

#### Plot 1-4: Correlation between Tsunami Occurrence and Houses Destroyed(number of destroyed houses)

```{r}
# flag_tsunami vs volcano_houses_destroyed box plot
numeric_df |>
  filter(!is.na(volcano_houses_destroyed)) |>
  ggplot(aes(x = flag_tsunami, y = volcano_houses_destroyed, group = flag_tsunami)) +
  geom_boxplot() +
  labs(title = "Correlation between Tsunami Occurrence and Houses Destroyed", x = "Tsunami Occurrence", y = "Houses Destroyed") +
  theme_minimal()
```

```{r}
# flag_tsunami vs volcano_houses_destroyed bar plot
numeric_df |>
  filter(!is.na(volcano_houses_destroyed)) |>
  group_by(flag_tsunami) |>
  summarize(total_houses_destroyed = mean(volcano_houses_destroyed)) |>
  ggplot(aes(x = flag_tsunami, y = total_houses_destroyed, fill = flag_tsunami)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title ="Correlation between Tsunami Occurrence and Houses Destroyed", x = "Tsunami Occurrence", y = "Houses Destroyed") +
  theme_minimal() 
```

<mark> bar plot and box plot are different (meanï¼Ÿmedian?)

### Correlation between Earthquake Occurrence and Casualties and Property Losses Caused by Volcanic Activity

#### Plot 2-1: Correlation between Earthquake Occurrence and Injuries

```{r}
# flag_earthquake vs volcano_injuries box plot
numeric_df |>
  filter(!is.na(volcano_injuries)) |>
  ggplot(aes(x = flag_earthquake, y = volcano_injuries, group = flag_earthquake)) +
  geom_boxplot() +
  labs(title = "Correlation between Earthquake Occurrence and Injuries", x = "Earthquake Occurrence", y = "Injuries") +
  theme_minimal()
```

```{r}
# flag_earthquake vs volcano_injuries bar plot
numeric_df |>
  filter(!is.na(volcano_injuries)) |>
  group_by(flag_earthquake) |>
  summarize(total_injuries = mean(volcano_injuries)) |>
  ggplot(aes(x = flag_earthquake, y = total_injuries, fill = flag_earthquake)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Correlation between Earthquake Occurrence and Injuries", x = "Earthquake Occurrence", y = "Injuries") +
  theme_minimal() 
```

<mark> outlier 

#### Plot 2-2: Correlation between Earthquake Occurrence and Deaths

```{r}
# flag_earthquake vs volcano_deaths box plot
numeric_df |>
  filter(!is.na(volcano_deaths)) |>
  ggplot(aes(x = flag_earthquake, y = volcano_deaths, group = flag_earthquake)) +
  geom_boxplot() +
  labs(title = "Correlation between Earthquake Occurrence and Deaths", x = "Earthquake Occurrence", y = "Deaths") +
  theme_minimal()
```

```{r}
# flag_earthquake vs volcano_deaths bar plot
numeric_df |>
  filter(!is.na(volcano_deaths)) |>
  group_by(flag_earthquake) |>
  summarize(total_deaths = mean(volcano_deaths)) |>
  ggplot(aes(x = flag_earthquake, y = total_deaths, fill = flag_earthquake)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title ="Correlation between Earthquake Occurrence and Deaths", x = "Earthquake Occurrence", y = "Deaths") +
  theme_minimal() 
```

#### Plot 2-3: Correlation between Earthquake Occurrence and Damage(money in million)

```{r}
# flag_earthquake vs damage box plot
numeric_df |>
  filter(!is.na(volcano_damage_in_m)) |>
  ggplot(aes(x = flag_earthquake, y = volcano_damage_in_m, group = flag_earthquake)) +
  geom_boxplot() +
  labs(title = "Correlation between Earthquake Occurrence and Damage(money in million)", x = "Earthquake Occurrence", y = "Damage(money in million)") +
  theme_minimal()
```

```{r}
# flag_earthquake vs damage bar plot
numeric_df |>
  filter(!is.na(volcano_damage_in_m)) |>
  group_by(flag_earthquake) |>
  summarize(total_damage = mean(volcano_damage_in_m)) |>
  ggplot(aes(x = flag_earthquake, y = total_damage, fill = flag_earthquake)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title ="Correlation between Earthquake Occurrence and Damage(money in million)", x = "Earthquake Occurrence", y = "Damage(money in million)") +
  theme_minimal() 
```

#### Plot 2-4: Correlation between Earthquake Occurrence and Houses Destroyed(number of destroyed houses)

```{r}
# flag_earthquake vs volcano_houses_destroyed box plot
numeric_df |>
  filter(!is.na(volcano_houses_destroyed)) |>
  ggplot(aes(x = flag_earthquake, y = volcano_houses_destroyed, group = flag_earthquake)) +
  geom_boxplot() +
  labs(title = "Correlation between Earthquake Occurrence and Houses Destroyed", x = "Earthquake Occurrence", y = "Houses Destroyed") +
  theme_minimal()
```

```{r}
# flag_earthquake vs volcano_houses_destroyed bar plot
numeric_df |>
  filter(!is.na(volcano_houses_destroyed)) |>
  group_by(flag_earthquake) |>
  summarize(total_houses_destroyed = mean(volcano_houses_destroyed)) |>
  ggplot(aes(x = flag_earthquake, y = total_houses_destroyed, fill = flag_earthquake)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title ="Correlation between Earthquake Occurrence and Houses Destroyed", x = "Earthquake Occurrence", y = "Houses Destroyed") +
  theme_minimal() 
```

<mark> outlier

### Correlation between Volcano Type and Casualties and Property Losses Caused by Volcanic Activity

#### Plot 3-1: Correlation between Volcano Type and Injuries

```{r}
# volcano_type vs volcano_injuries box plot
numeric_df |>
  filter(!is.na(volcano_injuries)) |>
  ggplot(aes(x = volcano_type, y = volcano_injuries, group = volcano_type)) +
  geom_boxplot() +
  labs(title = "Correlation between Volcano Type and Injuries", x = "Volcano Type", y = "Injuries") +
  theme_minimal()
```

```{r}
# volcano_type vs volcano_injuries bar plot
numeric_df |>
  filter(!is.na(volcano_injuries)) |>
  group_by(volcano_type) |>
  summarize(total_injuries = mean(volcano_injuries)) |>
  ggplot(aes(x = reorder(volcano_type, total_injuries), y = total_injuries, fill = volcano_type)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Correlation between Volcano Type and Injuries", x = "Volcano Type", y = "Injuries") +
  theme_minimal() 
```

#### Plot 3-2: Correlation between Volcano Type and Deaths

```{r}
# volcano_type vs volcano_deaths box plot
numeric_df |>
  filter(!is.na(volcano_deaths)) |>
  ggplot(aes(x = volcano_type, y = volcano_deaths, group = volcano_type)) +
  geom_boxplot() +
  labs(title = "Correlation between Volcano Type and Deaths", x = "Volcano Type", y = "Deaths") +
  theme_minimal()
```

```{r}
# volcano_type vs volcano_deaths bar plot
numeric_df |>
  filter(!is.na(volcano_deaths)) |>
  group_by(volcano_type) |>
  summarize(total_deaths = mean(volcano_deaths)) |>
  ggplot(aes(x = reorder(volcano_type, total_deaths), y = total_deaths, fill = volcano_type)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title ="Correlation between Volcano Type and Deaths", x = "Volcano Type", y = "Deaths") +
  theme_minimal() 
```

#### Plot 3-3: Correlation between Volcano Type and Damage(money in million)

```{r}
# volcano_type vs damage box plot
numeric_df |>
  filter(!is.na(volcano_damage_in_m)) |>
  ggplot(aes(x = volcano_type, y = volcano_damage_in_m, group = volcano_type)) +
  geom_boxplot() +
  labs(title = "Correlation between Volcano Type and Damage(money in million)", x = "Volcano Type", y = "Damage(money in million)") +
  theme_minimal()
```

```{r}
# volcano_type vs damage bar plot
numeric_df |>
  filter(!is.na(volcano_damage_in_m)) |>
  group_by(volcano_type) |>
  summarize(total_damage = mean(volcano_damage_in_m)) |>
  ggplot(aes(x = reorder(volcano_type, total_damage), y = total_damage, fill = volcano_type)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title ="Correlation between Volcano Type and Damage(money in million)", x = "Volcano Type", y = "Damage(money in million)") +
  theme_minimal() 
```

#### Plot 3-4: Correlation between Volcano Type and Houses Destroyed(number of destroyed houses)

```{r}
# volcano_type vs volcano_houses_destroyed box plot
numeric_df |>
  filter(!is.na(volcano_houses_destroyed)) |>
  ggplot(aes(x = volcano_type, y = volcano_houses_destroyed, group = volcano_type)) +
  geom_boxplot() +
  labs(title = "Correlation between Volcano Type and Houses Destroyed", x = "Volcano Type", y = "Houses Destroyed") +
  theme_minimal()
```

```{r}
# volcano_type vs volcano_houses_destroyed bar plot
numeric_df |>
  filter(!is.na(volcano_houses_destroyed)) |>
  group_by(volcano_type) |>
  summarize(total_houses_destroyed = mean(volcano_houses_destroyed)) |>
  ggplot(aes(x = reorder(volcano_type, total_houses_destroyed), y = total_houses_destroyed, fill = volcano_type)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title ="Correlation between Volcano Type and Houses Destroyed", x = "Volcano Type", y = "Houses Destroyed") +
  theme_minimal() 
```

### Correlation between VEI(Volcanic Explosivity Index) and Casualties and Property Losses Caused by Volcanic Activity

#### Plot 4-1: Correlation between VEI and Injuries

```{r}
# VEI vs volcano_injuries box plot
numeric_df |>
  filter(!is.na(volcano_injuries),
         !is.na(volcanic_explosivity_index)) |>
  ggplot(aes(x = volcanic_explosivity_index, y = volcano_injuries, group = volcanic_explosivity_index)) +
  geom_boxplot() +
  labs(title = "Correlation between VEI and Injuries", x = "VEI", y = "Injuries") +
  theme_minimal()
```

```{r}
# VEI vs volcano_injuries bar plot
numeric_df |>
  filter(!is.na(volcano_injuries),
         !is.na(volcanic_explosivity_index)) |>
  group_by(volcanic_explosivity_index) |>
  summarize(total_injuries = mean(volcano_injuries)) |>
  ggplot(aes(x = reorder(volcanic_explosivity_index, total_injuries), y = total_injuries, fill = volcanic_explosivity_index)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Correlation between VEI and Injuries", x = "VEI", y = "Injuries") +
  theme_minimal() 
```

<mark> outlier

#### Plot 4-2: Correlation between VEI and Deaths

```{r}
# VEI vs volcano_deaths box plot
numeric_df |>
  filter(!is.na(volcano_deaths),
         !is.na(volcanic_explosivity_index)) |>
  ggplot(aes(x = volcanic_explosivity_index, y = volcano_deaths, group = volcanic_explosivity_index)) +
  geom_boxplot() +
  labs(title = "Correlation between VEI and Deaths", x = "VEI", y = "Deaths") +
  theme_minimal()
```

```{r}
# VEI vs volcano_deaths bar plot
numeric_df |>
  filter(!is.na(volcano_deaths),
         !is.na(volcanic_explosivity_index)) |>
  group_by(volcanic_explosivity_index) |>
  summarize(total_deaths = mean(volcano_deaths)) |>
  ggplot(aes(x = reorder(volcanic_explosivity_index, total_deaths), y = total_deaths, fill = volcanic_explosivity_index)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title ="Correlation between VEI and Deaths", x = "VEI", y = "Deaths") +
  theme_minimal() 
```

#### Plot 4-3: Correlation between VEI and Damage(money in million)

```{r}
# VEI vs damage box plot
numeric_df |>
  filter(!is.na(volcano_damage_in_m),
         !is.na(volcanic_explosivity_index)) |>
  ggplot(aes(x = volcanic_explosivity_index, y = volcano_damage_in_m, group = volcanic_explosivity_index)) +
  geom_boxplot() +
  labs(title = "Correlation between VEI and Damage(money in million)", x = "VEI", y = "Damage(money in million)") +
  theme_minimal()
```

```{r}
# VEI vs damage bar plot
numeric_df |>
  filter(!is.na(volcano_damage_in_m),
         !is.na(volcanic_explosivity_index)) |>
  group_by(volcanic_explosivity_index) |>
  summarize(total_damage = mean(volcano_damage_in_m)) |>
  ggplot(aes(x = reorder(volcanic_explosivity_index, total_damage), y = total_damage, fill = volcanic_explosivity_index)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title ="Correlation between VEI and Damage(money in million)", x = "VEI", y = "Damage(money in million)") +
  theme_minimal() 
```

#### Plot 4-4: Correlation between VEI and Houses Destroyed(number of destroyed houses)

```{r}
# VEI vs volcano_houses_destroyed box plot
numeric_df |>
  filter(!is.na(volcano_houses_destroyed),
         !is.na(volcanic_explosivity_index)) |>
  ggplot(aes(x = volcanic_explosivity_index, y = volcano_houses_destroyed, group = volcanic_explosivity_index)) +
  geom_boxplot() +
  labs(title = "Correlation between VEI and Houses Destroyed", x = "VEI", y = "Houses Destroyed") +
  theme_minimal()
```

```{r}
# VEI vs volcano_houses_destroyed bar plot
numeric_df |>
  filter(!is.na(volcano_houses_destroyed),
         !is.na(volcanic_explosivity_index)) |>
  group_by(volcanic_explosivity_index) |>
  summarize(total_houses_destroyed = mean(volcano_houses_destroyed)) |>
  ggplot(aes(x = reorder(volcanic_explosivity_index, total_houses_destroyed), y = total_houses_destroyed, fill = volcanic_explosivity_index)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title ="Correlation between VEI and Houses Destroyed", x = "VEI", y = "Houses Destroyed") +
  theme_minimal() 
```

<mark> outlier


-------------------

## The Factors Influencing Casualties and Property Losses Caused by Volcanic Activity(descriptive)

Using bar charts, we can take a look at the levels of casualties and damages from volcanic eruptions with different factors involved.

```{r}
cad_df = tidy_df |>
  select(year, flag_tsunami, flag_earthquake,
         volcano_type, volcanic_explosivity_index, 
         volcano_deaths_description, volcano_injuries_description,
         volcano_damage_description, volcano_houses_destroyed_description,
         volcano_deaths, volcano_injuries, 
         volcano_damage_in_m, volcano_houses_destroyed)
```


### Tsunami and Earthquake

```{r deaths}
p1 = cad_df|>
  filter(volcano_deaths_description != "None/No Record") |>
  ggplot(aes(x = flag_tsunami, fill = volcano_deaths_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Proportion of Casualty Levels for Eruptions with Deaths",
       x = "Tsunami",
       y = "Proportion") +
  theme(legend.position = "none")

p2 = cad_df|>
  filter(volcano_deaths_description != "None/No Record") |>
  ggplot(aes(x = flag_earthquake, fill = volcano_deaths_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "", x = "Earthquake", y = "Proportion") +
  theme(legend.position = "none")

p_row = 
  plot_grid(
  p1 + theme(legend.position="none"), 
  p2 + theme(legend.position="none"),
  align = 'vh',
  nrow = 1
  )

legends = get_legend(
  p1 + 
    guides(fill = guide_legend(nrow = 2), byrow=TRUE) +
    theme(legend.position = "bottom") +
    theme(legend.title=element_blank())
)

plot_grid(p_row, legends, ncol = 1, rel_heights = c(1, .1))
```

```{r injuries}
p1 = cad_df|>
  filter(volcano_injuries_description != "None/No Record") |>
  ggplot(aes(x = flag_tsunami, fill = volcano_injuries_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Proportion of Casualty Levels for Eruptions with Injuries",
       x = "Tsunami",
       y = "Proportion") +
  theme(legend.position = "none")

p2 = cad_df|>
  filter(volcano_injuries_description != "None/No Record") |>
  ggplot(aes(x = flag_earthquake, fill = volcano_injuries_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "", x = "Earthquake", y = "Proportion") +
  theme(legend.position = "none")

p_row = 
  plot_grid(
  p1 + theme(legend.position="none"), 
  p2 + theme(legend.position="none"),
  align = 'vh',
  nrow = 1
  )

legends = get_legend(
  p1 + 
    guides(fill = guide_legend(nrow = 2), byrow=TRUE) +
    theme(legend.position = "bottom") +
    theme(legend.title=element_blank())
)

plot_grid(p_row, legends, ncol = 1, rel_heights = c(1, .1))
```

```{r damages}
p1 = cad_df|>
  filter(volcano_damage_description != "None/No Record") |>
  ggplot(aes(x = flag_tsunami, fill = volcano_damage_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Proportion of Loss Levels for Eruptions with Damages",
       x = "Tsunami",
       y = "Proportion") +
  theme(legend.position = "none")

p2 = cad_df|>
  filter(volcano_damage_description != "None/No Record") |>
  ggplot(aes(x = flag_earthquake, fill = volcano_damage_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "", x = "Earthquake", y = "Proportion") +
  theme(legend.position = "none")

p_row = 
  plot_grid(
  p1 + theme(legend.position="none"), 
  p2 + theme(legend.position="none"),
  align = 'vh',
  nrow = 1
  )

legends = get_legend(
  p1 + 
    guides(fill = guide_legend(nrow = 2), byrow=TRUE) +
    theme(legend.position = "bottom") +
    theme(legend.title=element_blank())
)

plot_grid(p_row, legends, ncol = 1, rel_heights = c(1, .1))
```

```{r houses destroyed}
p1 = cad_df|>
  filter(volcano_houses_destroyed_description != "None/No Record") |>
  ggplot(aes(x = flag_tsunami, fill = volcano_houses_destroyed_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Proportion of Loss Levels for Eruptions with Houses Destroyed",
       x = "Tsunami",
       y = "Proportion") +
  theme(legend.position = "none")

p2 = cad_df|>
  filter(volcano_houses_destroyed_description != "None/No Record") |>
  ggplot(aes(x = flag_earthquake, fill = volcano_houses_destroyed_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "", x = "Earthquake", y = "Proportion") +
  theme(legend.position = "none")

p_row = 
  plot_grid(
  p1 + theme(legend.position="none"), 
  p2 + theme(legend.position="none"),
  align = 'vh',
  nrow = 1
  )

legends = get_legend(
  p1 + 
    guides(fill = guide_legend(nrow = 2), byrow=TRUE) +
    theme(legend.position = "bottom") +
    theme(legend.title=element_blank())
)

plot_grid(p_row, legends, ncol = 1, rel_heights = c(1, .1))
```

We can see that in general, for volcanic eruptions with casualties and damages, the occurrence of tsunami and earthquakes will increase the severity of the losses.

### VEI

```{r VEI deaths}
cad_df|>
  filter(
    volcano_deaths_description != "None/No Record",
    !is.na(volcanic_explosivity_index)
    ) |>
  ggplot(
    aes(x = factor(volcanic_explosivity_index), fill = volcano_deaths_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Proportion of Casualty Levels for Eruptions with Deaths",
       x = "VEI",
       y = "Proportion") +
  theme(legend.position = "bottom") +
  theme(legend.title=element_blank())
```

```{r VEI injuries}
cad_df|>
  filter(
    volcano_injuries_description != "None/No Record",
    !is.na(volcanic_explosivity_index)
    ) |>
  ggplot(
    aes(x = factor(volcanic_explosivity_index), fill = volcano_injuries_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Proportion of Casualty Levels for Eruptions with Injuries",
       x = "VEI",
       y = "Proportion") +
  theme(legend.position = "bottom") +
  theme(legend.title=element_blank())
```

```{r VEI damages}
cad_df|>
  filter(
    volcano_damage_description != "None/No Record",
    !is.na(volcanic_explosivity_index)
    ) |>
  ggplot(
    aes(x = factor(volcanic_explosivity_index), fill = volcano_damage_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Proportion of Casualty Levels for Eruptions with Damages",
       x = "VEI",
       y = "Proportion") +
  theme(legend.position = "bottom") +
  theme(legend.title=element_blank())
```

```{r VEI houses destroyed}
cad_df|>
  filter(
    volcano_houses_destroyed_description != "None/No Record",
    !is.na(volcanic_explosivity_index)
    ) |>
  ggplot(aes(
    x = factor(volcanic_explosivity_index), 
    fill = volcano_houses_destroyed_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Proportion of Casualty Levels for Eruptions with Houses Destroyed",
       x = "VEI",
       y = "Proportion") +
  theme(legend.position = "bottom") +
  theme(legend.title=element_blank())
```

We can see that as VEI increases, the proportion of volcanic eruptions with more severe losses also increases, especially for casualty levels. This indicates that eruptions with a large VEI is likely to be more deadly.


-----------------------------

## Time Distribution of Volcanic Eruptions

### Tidy data
```{r}
voc_year <- tidy_df%>%
  group_by(year,volcanic_explosivity_index)%>%
  summarise(count = n())
```

```{r}
voc_year$period <- ifelse(voc_year$year < 0, "Before Christ",
ifelse(voc_year$year <= 1000, "0-1000",
ifelse(voc_year$year <= 1500, "1000-1500",
ifelse(voc_year$year <= 1899, "1500-1900",
ifelse(tidy_df$year <= 1999, "20th century", "21st century"))))) 

voc_year$period <- factor(voc_year$period, levels = c("Before Christ", "0-1000", "1000-1500", "1500-1900", "20th century","21st century"))
```

#### Plot 1: Volcanic Explosivity Index Frequency Over Periods
```{r}
expo_frequency<- voc_year%>%
  select(period,volcanic_explosivity_index)%>%
  group_by(period)%>%
  summarise(count = n()) 
```

```{r}
ggplot(expo_frequency,aes(x = period, y = count))+
  geom_bar(stat="identity",fill = "#D04F4F")+
  labs(
    x = "Period",
    y = "Count",
    title = "Volcanic Explosivity Index Frequency Over Periods"
  )
```

#### Plot2: Volcanic Explosivity Index Count Over Periods
```{r}
expo <- voc_year%>%
  select(period,volcanic_explosivity_index)%>%
  group_by(period,volcanic_explosivity_index)%>%
  summarise(count = n())
```

```{r,fig.width=9}
ggplot(expo,aes(x = period, y = count,fill = volcanic_explosivity_index))+
  geom_bar(stat="identity", position="stack") +
   labs(
    x = "Period",
    y = "Count",
    title = "Volcanic Explosivity Index Count Over Periods"
  )
```

### Tidy Data 2
```{r}
time_df <- tidy_df |>
  filter(year > 1900) |>
  mutate(
    volcano_deaths = replace(volcano_deaths, is.na(volcano_deaths), 0),
    volcano_injuries = replace(volcano_injuries, is.na(volcano_injuries), 0),
    volcano_damage_in_m = replace(volcano_damage_in_m, is.na(volcano_damage_in_m), 0),
    volcano_houses_destroyed = replace(volcano_houses_destroyed, is.na(volcano_houses_destroyed), 0),
    year = as.character(year)
  ) |>
group_by(year) |>
  summarize(
    total_deaths = sum(volcano_deaths,na.rm = TRUE),
    total_injuries = sum(volcano_injuries,na.rm = TRUE),
    total_damage = sum(volcano_damage_in_m,na.rm = TRUE),
    total_house_destruction = sum(volcano_houses_destroyed,na.rm = TRUE)
  )

```

#### Plot 3:Analysis of Toal Deaths and Total Injuries Over Time
```{r}
ggplot(time_df, aes(x = as.numeric(year))) +
  geom_line(aes(y = total_deaths, color = "Deaths"), size = 1) +
  geom_line(aes(y = total_injuries, color = "Injuries"), size = 1) +
  labs(
    title = "Analysis of Toal Deaths and Total Injuries Over Time",
    x = "Year",
    y = "Count",
    color = "Variable"
  )
```

#### Plot 4: Analysis of Total Damage and House Destruction Over Time
```{r}
ggplot(time_df, aes(x = as.numeric(year))) +
  geom_line(aes(y = total_damage, color = "Damage"), size = 1) +
  geom_line(aes(y = total_house_destruction, color = "House Destruction"), size = 1)+
  labs(
    title = "Analysis of Total Damage and House Destruction Over Time",
    x = "Year",
    y = "Count",
    color = "Variable"
  ) 
```

## Iceland Volcanic Activity Analysis

```{r}
library(tidyverse)
library(ggplot2)
iceland_volcanic_data = read_delim("data/significant-volcanic-eruption-database.csv") |>
  filter(Country == "Iceland") |>
  janitor::clean_names()

ggplot(iceland_volcanic_data, aes(x = year)) +
  geom_histogram(bins = 30, fill = "#69b3a2", color = "#1b4332") +
  theme_minimal() +
  labs(title = "Distribution of Volcanic Eruptions in Iceland Over Time",
       x = "Year",
       y = "Number of Eruptions")
library(tidyverse)
library(ggplot2)

iceland_volcanic_data %>%
  count(volcano_type) %>%
  arrange(desc(n)) %>%
  mutate(volcano_type = factor(volcano_type, levels = volcano_type)) %>%
  ggplot(aes(x = volcano_type, y = n, fill = volcano_type)) + 
  geom_col() + 
  scale_fill_brewer(palette = "Reds") +
  theme_minimal() +
  labs(title = "Prevalence of Different Volcano Types in Iceland",
       x = "Volcano Type",
       y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

iceland_volcanic_data |>
  mutate(vei_ordered = factor(volcanic_explosivity_index, levels = 1:6)) |>
  ggplot(aes(x = vei_ordered, fill = vei_ordered)) +
  geom_bar() +
  scale_fill_brewer(palette = "Blues") +
  theme_minimal() +
  labs(title = "Distribution of Volcanic Explosivity Index (VEI) in Iceland",
       x = "VEI",
       y = "Count")

```

