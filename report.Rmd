---
title: "Project Report"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: "hide"
---

```{r setup, include=FALSE}
library(tidyverse)
library(leaflet)
library(cowplot)
library(gridExtra)

# set knitr defaults
knitr::opts_chunk$set(
  echo = TRUE, 
  message = FALSE, 
  warning = FALSE,
  fig.width = 9
)

# set theme defaults
theme_set(theme_minimal() + theme(legend.position = "bottom"))

# set color scale defaults
options(
    ggplot2.continuous.colour = "viridis",
    ggplot2.continuous.fill   = "viridis")

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete   = scale_fill_viridis_d
```

## Motivation

Recently, a striking news about the potential volcano eruption in Iceland caught our attention. Motivated by the need to better understand and analyze the impact of such natural phenomena, we aim to delve into the patterns, trends, and factors surrounding volcanic eruptions, utilizing data science techniques to extract meaningful insights.

## Related Work

Caldera J, Wirasinghe S C. Analysis and classification of volcanic eruptions[J]. 2014.

## Initial Questions

* What are the characteristics and patterns of volcanic eruptions?

* What are the main factors that influence the losses (e.g. casualties, economic damage) caused by a volcanic eruption?

## Data

### Data Source

We use the [Significant Volcanic Eruption Database](https://public.opendatasoft.com/explore/dataset/significant-volcanic-eruption-database/information/) in our study. The original csv file can be downloaded at the linked website.

### Data Cleaning

```{r}
tidy_df = 
  read.csv(
    "data/significant-volcanic-eruption-database.csv", 
    sep = ";", na.strings=c("", NA)) |>
  janitor::clean_names() |>
  dplyr::select(
    -c(month, day, location, status, volcano_missing, volcano_missing_description, earthquakes_houses_damaged_description),
    -starts_with("total")
    ) |>
  mutate( # change flags to boolean
    flag_tsunami = case_match(flag_tsunami, "Tsunami"~ TRUE, NA ~ FALSE),
    flag_earthquake = case_match(flag_earthquake, "Earthquake"~ TRUE, NA ~ FALSE)
  ) |>
  separate(coordinates, into = c("lat", "long"), sep = ",") |>
  mutate(
    lat = as.numeric(lat), long = as.numeric(long)
  ) |>
  mutate_at(vars(ends_with('description')), ~ifelse(is.na(.), "None/No Record", .)) |>
  mutate( # shorten description
    volcano_deaths_description = case_match(
      volcano_deaths_description,
      "Very Many (~1001 or more deaths)" ~ "Very Many (~1001 or more)", 
      "Many (~101 to 1000 deaths)" ~ "Many (~101 to 1000)", 
      "Some (~51 to 100 deaths)" ~ "Some (~51 to 100)", 
      "Few (~1 to 50 deaths)" ~ "Few (~1 to 50)",
      "None/No Record" ~ "None/No Record"
    ),
    volcano_injuries_description = case_match(
      volcano_injuries_description,
      "Very Many (~1001 or more deaths)" ~ "Very Many (~1001 or more)", 
      "Many (~101 to 1000 deaths)" ~ "Many (~101 to 1000)", 
      "Some (~51 to 100 deaths)" ~ "Some (~51 to 100)", 
      "Few (~1 to 50 deaths)" ~ "Few (~1 to 50)",
      "None/No Record" ~ "None/No Record"
    ),
    volcano_damage_description = case_match(
      volcano_damage_description,
      "EXTREME (~$25 million or more)" ~ "EXTREME (~>=$25 million)", 
      "SEVERE (~>$5 to $24 million)" ~ "SEVERE (~$5 to $24 million)", 
      "MODERATE (~$1 to $5 million)" ~ "MODERATE (~$1 to $5 million)", 
      "LIMITED (roughly corresponding to less than $1 million)" ~ "LIMITED (~<$1 million)",
      "None/No Record" ~ "None/No Record"
    ),
    volcano_houses_destroyed_description = case_match(
      volcano_houses_destroyed_description,
      "Very Many (~1001 or more houses)" ~ "Very Many (~1001 or more)", 
      "Many (~101 to 1000 houses)" ~ "Many (~101 to 1000)", 
      "Some (~51 to 100 houses)" ~ "Some (~51 to 100)", 
      "Few (~1 to 50 houses)" ~ "Few (~1 to 50)",
      "None/No Record" ~ "None/No Record"
    )
  ) |>
  mutate( # change descriptions to factors w/ levels
    volcano_deaths_description = factor(volcano_deaths_description, levels = c("Very Many (~1001 or more)", "Many (~101 to 1000)", "Some (~51 to 100)", "Few (~1 to 50)", "None/No Record")),
    volcano_injuries_description = factor(volcano_injuries_description, levels = c("Very Many (~1001 or more)", "Many (~101 to 1000)", "Some (~51 to 100)", "Few (~1 to 50)", "None/No Record")),
    volcano_damage_description = factor(volcano_damage_description, levels = c("EXTREME (~>=$25 million)", "SEVERE (~$5 to $24 million)", "MODERATE (~$1 to $5 million)", "LIMITED (~<$1 million)", "None/No Record")),
    volcano_houses_destroyed_description = factor(volcano_houses_destroyed_description, levels = c("Very Many (~1001 or more)", "Many (~101 to 1000)", "Some (~51 to 100)", "Few (~1 to 50)", "None/No Record"))
  )

```

The raw data is a global listing of over 800 volcanic eruptions and their information. All the variables are compressed in two columns in the csv file, so when importing the data, we used `read.csv()` function to separate them by `;`, and set the empty values as `NA`.

Next, we cleaned the variable names with `janitor::clean_names()`, and removed the unwanted variables (e.g. `month` and `day` which are missing for many eruptions, `location` which is unnecessary in our study, variables of total effect which are mostly repetition of volcano  effect) from our dataframe.

Finally, we used `mutate()` function to make some necessary adjustments to the variables, including:

* Changed the variable type of `flag_tsunami` and `flag_earthquake` from character to boolean using `case_match()`.

* Separated variable `coordinates` into two numeric variables `lat`, `long` using `separate()` and `as.numeric()`.

* For the loss description variables, changed the `NA` values to `"None/No Record"`, shortened the description length using `case_match()` and changed their type from character to factor using `factor()`, assigning the levels according to severity.

The final dataframe used for the analysis, `tidy_df`,  has __18__ variables, listed below:

* `year`: the year of eruption
* `flag_tsunami`: whether there is a tsunami accompanying the volcanic eruption
* `flag_earthquake`: whether there is an earthquake accompanying the volcanic eruption
* `volcano_name`: the name of the volcano
* `country`: the country where the volcano is located
* `elevation`: the elevation of the volcano
* `volcano_type`: the type of the volcano
* `volcanic_explosivity_index`: VEI          
* `volcano_deaths`: number of deaths caused by the eruption
* `volcano_deaths_description`: severity level of deaths
* `volcano_injuries`: number of injuries caused by the eruption                    
* `volcano_injuries_description`: severity level of injuries
* `volcano_damage_in_m`: economic damage in million caused by the eruption             
* `volcano_damage_description`: severity level of economic damage
* `volcano_houses_destroyed`: number of houses destroyed by the eruption             
* `volcano_houses_destroyed_description`: severity level of house destruction
* `lat`: latitude of the volcano                                 
* `long`: longitude of the volcano

## Exploratory Analysis

To visualize the characteristics of volcanic eruptions that we're interested in, we performed exploratory data analysis, which mainly consists of five parts: Distribution of Volcanic Eruptions (Geographical & Temporal), Factors Influencing Volcanic Losses (Numeric & Descriptive), and Analysis of Iceland Volcanic Activity.

### Geographical Distribution of Volcanic Eruptions

First, we want to figure out which countries or regions are most prone to volcanic eruptions, so we make an interactive map to display the geographical distribution of volcanoes.

```{r}
geo_df = 
  tidy_df |>
  select(volcano_name, country, volcano_type, elevation, lat, long) |>
  group_by(volcano_name, country, volcano_type, elevation, lat, long) |>
  summarise(eruption_count = n())

geo_df |>
  filter(eruption_count >= 2) |>
  leaflet() |>
  addTiles() |>
  addProviderTiles(providers$CartoDB.Positron) |>
  addMarkers(lat = ~lat, 
             lng = ~long, 
             clusterOptions = markerClusterOptions(),
             label = ~paste(
               "Name: ", volcano_name, "<br>",
               "Country: ", country, "<br>",
               "Volcano Type: ", volcano_type, "<br>",
               "Elevation: ", elevation, "<br>",
               "Eruption Count: ", eruption_count) |> lapply(htmltools::HTML)) 
```

We can notice that most volcanoes are located along the peripheries of continents. This pattern is a result of the tectonic plate boundaries where volcanic activity is often concentrated. 

We can also notice that the majority of volcanoes are located along the Pacific Ocean. This area is known as the "Ring of Fire". It traces boundaries between several tectonic plates—including the Pacific, Juan de Fuca, Cocos, Indian-Australian, Nazca, North American, and Philippine Plates.

```{r}
country1 =
  geo_df |>
  group_by(country)|>
  summarise(n = n()) |>
  arrange(desc(n)) |>
  head(5) |>
  ggplot(aes(x = reorder(country, -n), y = n, fill = country)) +
  geom_bar(stat = "identity", width = 0.6) +
  labs(title = "Top Five Countries with the Most Volcanoes",
       x = "Country",
       y = "Number of Volcanoes") +
  theme(legend.position = "none")


country2 =
  geo_df |>
  group_by(country)|>
  summarise(n = sum(eruption_count)) |>
  arrange(desc(n)) |>
  head(5) |>
  ggplot(aes(x = reorder(country, -n), y = n, fill = country)) +
  geom_bar(stat = "identity", width = 0.6) +
  labs(title = "Top Five Countries with the Most Volcanic Eruptions",
       x = "Country",
       y = "Number of Eruptions") +
  theme(legend.position = "none")

plot_grid(country1, country2, ncol = 1)
```

The top five countries with the most volcanoes are: Indonesia, Japan, United States, Papua New Guinea and Russia.  
The top five countries with the most volcanic eruptions are: Indonesia, Japan, Italy, Iceland and United States.

### Time Distribution of Volcanic Eruptions

Next, we want to explore the time distribution of these volcanic eruptions and their losses. We use bar chart and line plots to illustrate this temporal information.

```{r}
# Tidy data for plotting
voc_year <- tidy_df%>%
  group_by(year,volcanic_explosivity_index)%>%
  summarise(count = n())

voc_year$period <- ifelse(voc_year$year < 0, "Before Christ",
ifelse(voc_year$year <= 1000, "0-1000",
ifelse(voc_year$year <= 1500, "1000-1500",
ifelse(voc_year$year <= 1899, "1500-1900",
ifelse(tidy_df$year <= 1999, "20th century", "21st century"))))) 

# Change the variable type to factor
voc_year$period <- factor(voc_year$period, levels = c("Before Christ", "0-1000", "1000-1500", "1500-1900", "20th century","21st century"))
```

#### Volcanic Eruption Counts Over Time Periods

```{r}
expo <- voc_year |>
  select(period,volcanic_explosivity_index) |>
  group_by(period,volcanic_explosivity_index) |>
  summarise(count = n())

# Plotting
ggplot(expo,aes(x = period, y = count,fill = volcanic_explosivity_index)) +
  geom_bar(stat="identity", position="stack") +
   labs(
    x = "Period",
    y = "Count",
    title = "Volcanic Eruption Counts Over Time Periods"
  )
```
The above plot illustrates the total number of volcanic eruptions across different time periods. The period from 1500 to 1900 recorded the highest number of volcanic eruptions, totaling around 250. 

The number of eruptions in the 20th century is approximately equal to the total number of eruptions from 1500 to 1900, with most eruptions’ VEI ranging from 2 to 5. The total number of eruptions across the remaining four time periods is nearly identical. For eruptions occurring before Christ or from 0 to 1000 A.D., those with a VEI of 6 constitute the main type of eruption. This is probably because only the most colossal volcanic eruptions were documented during this ancient era.

#### Analysis of Deaths and Injuries Over Time
```{r}
time_df <- tidy_df |>
  filter(year > 1900) |>
  mutate(
    volcano_deaths = replace(volcano_deaths, is.na(volcano_deaths), 0),
    volcano_injuries = replace(volcano_injuries, is.na(volcano_injuries), 0),
    volcano_damage_in_m = replace(volcano_damage_in_m, is.na(volcano_damage_in_m), 0),
    volcano_houses_destroyed = replace(volcano_houses_destroyed, is.na(volcano_houses_destroyed), 0),
    year = as.character(year)
  ) |>
group_by(year) |>
  summarize(
    total_deaths = sum(volcano_deaths,na.rm = TRUE),
    total_injuries = sum(volcano_injuries,na.rm = TRUE),
    total_damage = sum(volcano_damage_in_m,na.rm = TRUE),
    total_house_destruction = sum(volcano_houses_destroyed,na.rm = TRUE)
  )


ggplot(time_df, aes(x = as.numeric(year))) +
  geom_line(aes(y = total_deaths, color = "Deaths"), size = 1) +
  geom_line(aes(y = total_injuries, color = "Injuries"), size = 1) +
  labs(
    title = "Analysis of Toal Deaths and Total Injuries Over Time",
    x = "Year",
    y = "Count",
    color = "Variable"
  )
```
As for the number of deaths, it reached its climax at over 30000 around 1900. As time progressed, the number of deaths fluctuated between 0 and 5000 until around 1985, when it reached another peak at about 25000. After that, the number of deaths dropped and continued to fluctuate between 0 and 1500.

When it comes to the number of injuries, however, the number did not fluctuate as drastically as the number of death. It remained stable from 1900 to around 1985. After hitting its pick at 10000 in around 1985, the number went down and continued to remain stable.

#### Analysis of Damage and Houses Destroyed Over Time

```{r}
ggplot(time_df, aes(x = as.numeric(year))) +
  geom_line(aes(y = total_damage, color = "Damage"), size = 1) +
  geom_line(aes(y = total_house_destruction, color = "Houses Destroyed"), size = 1)+
  labs(
    title = "Analysis of Damage and Houses Destroyed Over Time",
    x = "Year",
    y = "Count",
    color = "Variable"
  ) 
```
As for the number of houses destroyed, the most significant increase in damage and houses destroyed occurred between 1900 and 1925. The number then remained stable and fluctuated slightly until the 2020s, when the number of houses destroyed drastically fluctuated ranging from 0 to 3300.

In light of the number of damage, it remained stable over time and slightly fluctuated around 1975 and the 2010s respectively.

### Factors Influencing Volcanic Losses (Numeric)

After illustrating the distributions of volcanic eruptions, we move on to explore the impact of various factors on casualties and property losses resulting from volcanic eruptions. These factors include occurrence of tsunami and earthquake, type and elevation of the volcano and the volcanic explosivity index (VEI) of the eruption.

The volcanic losses we're interested here include deaths, injuries, damages (in million dollars) and houses destroyed. In this section, we will focus on the number of these losses.

```{r}
numeric_df = 
  tidy_df |> 
  select(year,flag_tsunami,flag_earthquake, elevation, 
         volcano_type, volcanic_explosivity_index,
         volcano_injuries, volcano_deaths, volcano_damage_in_m, volcano_houses_destroyed) |>
  mutate(
    flag_tsunami = factor(flag_tsunami),
    flag_earthquake = factor(flag_earthquake),
    volcanic_explosivity_index = factor(volcanic_explosivity_index))
```

#### Tsunami 

```{r}
par(mfrow = c(2,2))

# volcano_injuries vs flag_tsunami 
tsunami_injuries = 
  numeric_df |>
  filter(!is.na(volcano_injuries)) |>
  ggplot(aes(x = flag_tsunami, y = log(volcano_injuries), group = flag_tsunami, fill = flag_tsunami)) +
  geom_boxplot() +
  labs(title = "Injuries vs Tsunami", x = "Tsunami Occurrence", y = "ln_Injuries") +
  theme(legend.position = "none")


# volcano_deaths vs flag_tsunami
tsunami_deaths = 
  numeric_df |>
  filter(!is.na(volcano_deaths)) |>
  ggplot(aes(x = flag_tsunami, y = log(volcano_deaths), group = flag_tsunami, fill = flag_tsunami)) +
  geom_boxplot() +
  labs(title = "Deaths vs Tsunami", x = "Tsunami Occurrence", y = "ln_Deaths") +
  theme(legend.position = "none") 


# damage vs flag_tsunami
tsunami_damage = 
  numeric_df |>
  filter(!is.na(volcano_damage_in_m)) |>
  ggplot(aes(x = flag_tsunami, y = log(volcano_damage_in_m), group = flag_tsunami, fill = flag_tsunami)) +
  geom_boxplot() +
  labs(title = "Damage vs Tsunami", x = "Tsunami Occurrence", y = "ln_Damage(money in million)") +
  theme(legend.position = "none")


# volcano_houses_destroyed vs flag_tsunami 
tsunami_houses_destroyed = 
  numeric_df |>
  filter(!is.na(volcano_houses_destroyed)) |>
  ggplot(aes(x = flag_tsunami, y = log(volcano_houses_destroyed), group = flag_tsunami, fill = flag_tsunami)) +
  geom_boxplot() +
  labs(title = "Houses Destroyed vs Tsunami", x = "Tsunami Occurrence", y = "ln_Houses Destroyed") +
  theme(legend.position = "none")

grid.arrange(tsunami_deaths, tsunami_injuries, tsunami_damage, tsunami_houses_destroyed, ncol = 2)
```

The box plots above indicate a noticeable influence of tsunami occurrence on the volcanic losses. The tsunami effects triggered by volcanic activities are likely to contribute to an increase in both casualties and property damage.

#### Earthquake 

```{r}
par(mfrow = c(2,2))

# volcano_injuries vs flag_earthquake
earthquake_injuries = 
  numeric_df |>
  filter(!is.na(volcano_injuries)) |>
  ggplot(aes(x = flag_earthquake, y = log(volcano_injuries), group = flag_earthquake, fill = flag_earthquake)) +
  geom_boxplot() +
  labs(title = "Injuries vs Earthquake", x = "Earthquake Occurrence", y = "ln_Injuries") +
  theme(legend.position = "none") 


#volcano_deaths vs flag_earthquake
earthquake_deaths = 
  numeric_df |>
  filter(!is.na(volcano_deaths)) |>
  ggplot(aes(x = flag_earthquake, y = log(volcano_deaths), group = flag_earthquake, fill = flag_earthquake)) +
  geom_boxplot() +
  labs(title = "Deaths vs Earthquake", x = "Earthquake Occurrence", y = "ln_Deaths") +
  theme(legend.position = "none")


#damage vs flag_earthquake 
earthquake_damage = 
  numeric_df |>
  filter(!is.na(volcano_damage_in_m)) |>
  ggplot(aes(x = flag_earthquake, y = log(volcano_damage_in_m), group = flag_earthquake, fill = flag_earthquake)) +
  geom_boxplot() +
  labs(title = "Damage vs Earthquake", x = "Earthquake Occurrence", y = "ln_Damage(money in million)") +
  theme(legend.position = "none")


#volcano_houses_destroyed vs flag_earthquake
earthquake_houses_destroyed = 
  numeric_df |>
  filter(!is.na(volcano_houses_destroyed)) |>
  ggplot(aes(x = flag_earthquake, y = log(volcano_houses_destroyed), group = flag_earthquake,fill = flag_earthquake)) +
  geom_boxplot() +
  labs(title = "Houses Destroyed vs Earthquake", x = "Earthquake Occurrence", y = "ln_Houses Destroyed") +
  theme(legend.position = "none")


grid.arrange(earthquake_deaths, earthquake_injuries, earthquake_damage, earthquake_houses_destroyed, ncol = 2)
```

The above box plots indicate that when volcanic eruptions trigger volcanic earthquakes, there is a generally noticeable increase in casualties and property damage compared to situations where volcanic earthquakes are not triggered.

#### Volcano Type 

```{r}
par(mfrow = c(2,2))

# volcano_injuries vs volcano_type
type_injuries =
  numeric_df |>
  filter(!is.na(volcano_injuries)) |>
  ggplot(aes(x = reorder(volcano_type, volcano_injuries, median), y = log(volcano_injuries), group = volcano_type, fill = volcano_type)) +
  geom_boxplot() +
  labs(title = "Injuries vs Volcano Type", x = "Volcano Type", y = "ln_Injuries") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")


# volcano_deaths vs volcano_type
type_deaths = 
  numeric_df |>
  filter(!is.na(volcano_deaths)) |>
  ggplot(aes(x = reorder(volcano_type, volcano_deaths, median), y = log(volcano_deaths), group = volcano_type, fill = volcano_type)) +
  geom_boxplot() +
  labs(title = "Deaths vs Volcano Type", x = "Volcano Type", y = "ln_Deaths")+
  theme(axis.text.x = element_text(angle = 60, hjust = 1), legend.position = "none")


# damage vs volcano_type
type_damage =
  numeric_df |>
  filter(!is.na(volcano_damage_in_m)) |>
  ggplot(aes(x = reorder(volcano_type, volcano_damage_in_m, median), y = log(volcano_damage_in_m), group = volcano_type, fill = volcano_type)) +
  geom_boxplot() +
  labs(title = "Damage vs Volcano Type", x = "Volcano Type", y = "ln_Damage")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")


# volcano_houses_destroyed vs volcano_type
type_houses_destroyed =
  numeric_df |>
  filter(!is.na(volcano_houses_destroyed)) |>
  ggplot(aes(x = reorder(volcano_type, volcano_houses_destroyed, median), y = log(volcano_houses_destroyed), group = volcano_type, fill = volcano_type)) +
  geom_boxplot() +
  labs(title = "Houses Destroyed vs Volcano Type", x = "Volcano Type", y = "ln_Houses Destroyed")+
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")

grid.arrange(type_deaths, type_injuries, type_damage, type_houses_destroyed, ncol = 2)
```


* The above box plots indicate that there is no clear correlation between the types of volcanoes and the volcanic losses. Some volcanoes that result in significant property damage during eruptions do not necessarily lead to a high number of casualties (which may be related to missing values).
* Among these volcanoes, eruptions of the "Maar" type lead to the most severe casualties, while eruptions of the "Stratovolcano" type comparatively result in more substantial property damage.

#### VEI 

```{r}
par(mfrow = c(2,2))

# volcano_injuries vs VEI
VEI_injuries = 
  numeric_df |>
  filter(!is.na(volcano_injuries),
         !is.na(volcanic_explosivity_index)) |>
  ggplot(aes(x = volcanic_explosivity_index, y = log(volcano_injuries), group = volcanic_explosivity_index, fill = volcanic_explosivity_index)) +
  geom_boxplot() +
  labs(title = "Injuries vs VEI", x = "VEI (level)", y = "ln_Injuries")+
  theme(legend.position = "none")


# volcano_deaths vs VEI
VEI_deaths = 
  numeric_df |>
  filter(!is.na(volcano_deaths),
         !is.na(volcanic_explosivity_index)) |>
  ggplot(aes(x = volcanic_explosivity_index, y = log(volcano_deaths), group = volcanic_explosivity_index, fill = volcanic_explosivity_index)) +
  geom_boxplot() +
  labs(title = "Deaths vs VEI", x = "VEI (level)", y = "ln_Deaths")+
  theme(legend.position = "none")


# damage vs VEI 
VEI_damage =
  numeric_df |>
  filter(!is.na(volcano_damage_in_m),
         !is.na(volcanic_explosivity_index)) |>
  ggplot(aes(x = volcanic_explosivity_index, y = log(volcano_damage_in_m), group = volcanic_explosivity_index, fill = volcanic_explosivity_index)) +
  geom_boxplot() +
  labs(title = "Damage vs VEI", x = "VEI (level)", y = "ln_Damage") +
  theme(legend.position = "none")


# volcano_houses_destroyed vs VEI
VEI_houses_destroyed =
  numeric_df |>
  filter(!is.na(volcano_houses_destroyed),
         !is.na(volcanic_explosivity_index)) |>
  ggplot(aes(x = volcanic_explosivity_index, y = log(volcano_houses_destroyed), group = volcanic_explosivity_index, fill = volcanic_explosivity_index)) +
  geom_boxplot() +
  labs(title = "Houses Destroyed vs VEI", x = "VEI (level)", y = "ln_Houses Destroyed") +
  theme(legend.position = "none")


grid.arrange(VEI_deaths, VEI_injuries, VEI_damage, VEI_houses_destroyed, ncol = 2)
```

The above box plots show that with the increase in the volcanic explosivity index, there is a general upward trend in casualties and property damage caused by volcanic eruptions. In other words, as the energy of the volcanic eruption increases, the casualties and losses become more severe.

#### Elevation 

```{r}
par(mfrow = c(2,2))

# volcano_injuries vs elevation
elevation_injuries = 
  numeric_df |>
  filter(!is.na(volcano_injuries),
         !is.na(elevation)) |>
  ggplot(aes(x = elevation, y = log(volcano_injuries))) +
  geom_point() +
  geom_smooth(se = FALSE)+
  labs(title = "Injuries VS Elevation", x = "Elevation", y = "ln_Injuries")+
  theme(legend.position = "none")

# volcano_deaths vs elevation
elevation_deaths = 
  numeric_df |>
  filter(!is.na(volcano_deaths),
         !is.na(elevation)) |>
  ggplot(aes(x = elevation, y = log(volcano_deaths))) +
  geom_point() +
  geom_smooth(se = FALSE)+
  labs(title = "Deaths vs Elevation", x = "Elevation", y = "ln_Deaths")+
  theme(legend.position = "none")


# damage vs elevation 
elevation_damage =
  numeric_df |>
  filter(!is.na(volcano_damage_in_m),
         !is.na(elevation)) |>
  ggplot(aes(x = elevation, y = log(volcano_damage_in_m))) +
  geom_point() +
  geom_smooth(se = FALSE)+
  labs(title = "Damage vs Elevation", x = "Elevation", y = "ln_Damage") +
  theme(legend.position = "none")


# volcano_houses_destroyed vs elevation
elevation_houses_destroyed =
  numeric_df |>
  filter(!is.na(volcano_houses_destroyed),
         !is.na(elevation)) |>
  ggplot(aes(x = elevation, y = log(volcano_houses_destroyed))) +
  geom_point() +
  geom_smooth(se = FALSE)+
  labs(title = "Houses Destroyed vs Elevation", x = "Elevation", y = "ln_Houses Destroyed") +
  theme(legend.position = "none")


grid.arrange(elevation_deaths, elevation_injuries, elevation_damage, elevation_houses_destroyed, ncol = 2)
```

The above plots show that, apart from the deaths, there is no significant correlation between the elevation of volcanoes and the number of injuries or property damage. Volcanoes at higher elevations tend to result in a higher number of deaths, and this trend becomes more pronounced when the volcano's elevation exceeds 5000 meters.


### Factors Influencing Volcanic Losses (Descriptive)

Using bar charts, we can take a look at the severity levels of casualties and damages with different factors involved.

Considering the problem with missing data and our interest of study, we will filter out the "None/No Record" values when examining loss levels and focus on the observations with losses recorded.

```{r}
cad_df = tidy_df |>
  select(year, flag_tsunami, flag_earthquake,
         volcano_type, volcanic_explosivity_index, 
         volcano_deaths_description, volcano_injuries_description,
         volcano_damage_description, volcano_houses_destroyed_description,
         volcano_deaths, volcano_injuries, 
         volcano_damage_in_m, volcano_houses_destroyed,
         elevation)
```



#### Tsunami

```{r tsunami losses}
p1 = cad_df|>
  filter(volcano_deaths_description != "None/No Record") |>
  ggplot(aes(x = flag_tsunami, fill = volcano_deaths_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Deaths",
       x = "Tsunami",
       y = "Proportion") +
  theme(legend.position = "none")

p2 = cad_df|>
  filter(volcano_injuries_description != "None/No Record") |>
  ggplot(aes(x = flag_tsunami, fill = volcano_injuries_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Injuries",
       x = "Tsunami",
       y = "Proportion") +
  theme(legend.position = "none")

p3 = cad_df|>
  filter(volcano_damage_description != "None/No Record") |>
  ggplot(aes(x = flag_tsunami, fill = volcano_damage_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Damages",
       x = "Tsunami",
       y = "Proportion") +
  theme(legend.position = "none")

p4 = cad_df|>
  filter(volcano_houses_destroyed_description != "None/No Record") |>
  ggplot(aes(x = flag_tsunami, fill = volcano_houses_destroyed_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Houses Destroyed",
       x = "Tsunami",
       y = "Proportion") +
  theme(legend.position = "none")
```

```{r}
legends_1 = get_legend(
  p1 + 
    guides(fill = guide_legend(nrow = 1, title="Losses"), byrow=TRUE) +
    theme(legend.position = "bottom") +
    theme(legend.title=element_blank())
)
legends_2 = get_legend(
  p3 + 
    guides(fill = guide_legend(nrow = 2, title="Damages"), byrow=TRUE) +
    theme(legend.position = "bottom") +
    theme(legend.title=element_blank())
)
mylegends = plot_grid(legends_1, legends_2, nrow = 2)

par(mfrow = c(2,2))

#grid.arrange(p1, p2, p3, p4, ncol = 2)
grid.arrange(
  arrangeGrob(p1, p2, p3, p4, nrow = 1), 
  mylegends, 
  nrow = 2, heights=c(10, 3))
```

We can see that in general, for volcanic eruptions with casualties and damages, the occurrence of tsunami will increase the severity of the losses.


#### Earthquake

```{r earthquake losses}
p1 = cad_df|>
  filter(volcano_deaths_description != "None/No Record") |>
  ggplot(aes(x = flag_earthquake, fill = volcano_deaths_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Deaths",
       x = "Earthquake",
       y = "Proportion") +
  theme(legend.position = "none")

p2 = cad_df|>
  filter(volcano_injuries_description != "None/No Record") |>
  ggplot(aes(x = flag_earthquake, fill = volcano_injuries_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Injuries",
       x = "Earthquake",
       y = "Proportion") +
  theme(legend.position = "none")

p3 = cad_df|>
  filter(volcano_damage_description != "None/No Record") |>
  ggplot(aes(x = flag_earthquake, fill = volcano_damage_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Damages",
       x = "Earthquake",
       y = "Proportion") +
  theme(legend.position = "none")

p4 = cad_df|>
  filter(volcano_houses_destroyed_description != "None/No Record") |>
  ggplot(aes(x = flag_earthquake, fill = volcano_houses_destroyed_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Houses Destroyed",
       x = "Earthquake",
       y = "Proportion") +
  theme(legend.position = "none")

```

```{r}
par(mfrow = c(2,2))

#grid.arrange(p1, p2, p3, p4, ncol = 2)
grid.arrange(
  arrangeGrob(p1, p2, p3, p4, nrow = 1), 
  mylegends, 
  nrow = 2, heights=c(10, 3))
```

We can see that in general, for volcanic eruptions with casualties and damages, the occurrence of earthquakes will increase the severity of the losses.



#### VEI

```{r VEI losses}
p1 = cad_df|>
  filter(
    volcano_deaths_description != "None/No Record",
    !is.na(volcanic_explosivity_index)
    ) |>
  ggplot(
    aes(x = factor(volcanic_explosivity_index), fill = volcano_deaths_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Deaths",
       x = "VEI",
       y = "Proportion") +
  theme(legend.position = "none")

p2 = cad_df|>
  filter(
    volcano_injuries_description != "None/No Record",
    !is.na(volcanic_explosivity_index)
    ) |>
  ggplot(
    aes(x = factor(volcanic_explosivity_index), fill = volcano_injuries_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Injuries",
       x = "VEI",
       y = "Proportion") +
  theme(legend.position = "none")

p3 = cad_df|>
  filter(
    volcano_damage_description != "None/No Record",
    !is.na(volcanic_explosivity_index)
    ) |>
  ggplot(
    aes(x = factor(volcanic_explosivity_index), fill = volcano_damage_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Damages",
       x = "VEI",
       y = "Proportion") +
  theme(legend.position = "none")

p4 = cad_df|>
  filter(
    volcano_houses_destroyed_description != "None/No Record",
    !is.na(volcanic_explosivity_index)
    ) |>
  ggplot(aes(
    x = factor(volcanic_explosivity_index), 
    fill = volcano_houses_destroyed_description)) +
  geom_bar(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Houses Destroyed",
       x = "VEI",
       y = "Proportion") +
  theme(legend.position = "none")
```

```{r}
par(mfrow = c(2,2))

grid.arrange(
  arrangeGrob(p1, p2, p3, p4, nrow = 2), 
  mylegends, 
  nrow = 2, heights=c(10, 3))
```

We can see that as VEI increases, the proportion of volcanic eruptions with more severe losses also increases, especially for casualty levels. This indicates that eruptions with a large VEI is likely to be more deadly.



#### Elevation

```{r elevation losses}
elv_df = cad_df|>
  filter(!is.na(elevation)) |>
  mutate(
    height = ifelse(elevation < 0, "< 0",
      ifelse(elevation <= 1000, "0-1000",
        ifelse(elevation <= 2000, "1000-2000",
          ifelse(elevation <= 3000, "2000-3000",
            ifelse(elevation <= 4000, "3000-4000",
              ifelse(elevation <= 5000, "4000-5000", "> 5000")))))) ) |>
  mutate(height = factor(height, levels = c("< 0", "0-1000", "1000-2000", "2000-3000", "3000-4000", "4000-5000", "> 5000")))


p1 = elv_df |>
  filter(
    volcano_deaths_description != "None/No Record",
    ) |>
  ggplot(
    aes(x = height, fill = volcano_deaths_description)) +
  geom_histogram(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Deaths",
       x = "Elevation (m)",
       y = "Proportion") +
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme(legend.position = "none")

p2 = elv_df |>
  filter(
    volcano_injuries_description != "None/No Record",
    ) |>
  ggplot(
    aes(x = height, fill = volcano_injuries_description)) +
  geom_histogram(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Injuries",
       x = "Elevation (m)",
       y = "Proportion") +
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme(legend.position = "none")

p3 = elv_df |>
  filter(
    volcano_damage_description != "None/No Record",
    ) |>
  ggplot(
    aes(x = height, fill = volcano_damage_description)) +
  geom_histogram(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Damages",
       x = "Elevation (m)",
       y = "Proportion") +
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme(legend.position = "none")

p4 = elv_df |>
  filter(
    volcano_houses_destroyed_description != "None/No Record",
    ) |>
  ggplot(
    aes(x = height, fill = volcano_houses_destroyed_description)) +
  geom_histogram(stat = "count", position = "fill") +
  geom_text(stat = "count",
            aes(label = ..count..),
            position = position_fill(vjust = 0.5)) +
  labs(title = "Houses Destroyed",
       x = "Elevation (m)",
       y = "Proportion") +
  theme(axis.text.x = element_text(angle = 30, hjust = 1)) +
  theme(legend.position = "none")
```

```{r}
par(mfrow = c(2,2))

grid.arrange(
  arrangeGrob(p1, p2, p3, p4, nrow = 2), 
  mylegends, 
  nrow = 2, heights=c(10, 3))
```

In terms of deaths, eruptions of volcanoes with an elevation over 5000 meters seem to have more severe results. However, for other types of losses, there don't seem to be a significant association between the severity levels and the elevation. This echoes the results in the previous analysis of numeric losses.

### Iceland Volcanic Activity Analysis

Finally, we will explore the characteristics of volcanic activities in Iceland.

```{r}
iceland_volcanic_data <- tidy_df %>%
  filter(country == "Iceland")

ggplot(iceland_volcanic_data, aes(x = year, fill = as.factor(-year))) +
  geom_histogram(bins = 30, color = "darkgray") +
  theme_minimal() +
  theme(legend.position = "none") + 
  labs(title = "Distribution of Volcanic Eruptions in Iceland Over Time",
       x = "Year",
       y = "Number of Eruptions")

```

The above plot shows the number of volcanic eruptions in Iceland over several centuries. The data suggests an increase in recorded eruptions over time, particularly around the late 1700s. However the increasing trend in later years could be attributed to better documentation as well as an actual increase in volcanic activity.

```{r}
iceland_volcanic_data %>%
  count(volcano_type) %>%
  arrange(desc(n)) %>%
  mutate(volcano_type = factor(volcano_type, levels = volcano_type)) %>%
  ggplot(aes(x = volcano_type, y = n, fill = volcano_type)) + 
  geom_col() + 
  theme_minimal() +
  labs(title = "Prevalence of Different Volcano Types in Iceland",
       x = "Volcano Type",
       y = "Count") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

The above plot indicates that stratovolcanoes are the most prevalent volcano type in Iceland, suggesting varied and complex volcanic activity.

```{r}
iceland_volcanic_data |>
  mutate(VEI = factor(volcanic_explosivity_index, levels = 1:6)) |>
  ggplot(aes(x = VEI, fill = fct_rev(VEI))) +
  geom_bar() +
  scale_fill_viridis_d(na.value = "gray")+
  theme_minimal() +
  labs(title = "Distribution of Volcanic Explosivity Index (VEI) in Iceland",
       x = "VEI",
       y = "Count")

```

The above plot shows that eruptions with a Volcanic Explosivity Index of 3 and 4 are most common in Iceland, indicating moderate explosivity is typical for Icelandic eruptions.

## Additional Analysis

Based on the results in exploratory data analysis, it is clear that deaths, injuries, damage and houses destroyed by volcanic eruptions can be affected by factors like earthquake, tsunami, VEI and elevation of the volcano. Because deaths is the only outcome that may be affected by all four factors mentioned above, we'll use deaths as the outcome in our model fitting. We'll utilize descriptive data on deaths from the dataset, and since it is an ordinal categorical variable, we'll use **ordinal logistic regression** to assess the association between predictors and the ordinal outcome.

```{r}
library(MASS)
library(Hmisc)
library(corrplot)
```

### Methodology

An **ordinal** variable is a categorical variable in which the levels have a natural ordering. Let $Y$ be an ordinal outcome with $J$ categories. Then $P(Y≤j)$is the cumulative probability of $Y$ less than or equal to a specific category
$j=1,...J-1$. The odds of being less than or equal a particular category can be defined as
$$\frac{P(Y≤j)}{P(Y>j)}$$
for $j=1,...J-1$ since $P(Y>j) = 0$ and dividing by zero is undefined. The **log odds** is also known as the **logit**, so that
$$log\frac{P(Y≤j)}{P(Y>j)}=logit(P(Y≤j))$$
In R’s polr the ordinal logistic regression model is parameterized as
$$logit(P(Y≤j))=β_{j0}-η_{1}x_{1}-η_{2}x_{2}-...-η_{p}x_{p}$$

In our case, we use the **ordinal logistic regression** to evaluate the effect of several factors on casualties and property losses which are the outcomes we are interested in. Predictors are tsunami, earthquake, VEI and elevation in this model. Our ordinal logistic regression model can be parameterized as:
$$logit(P(Y≤j))=β_{j0}-η_{1}X_{1}-η_{2}X_{2}-η_{3}X_{3}-η_{4}X_{4}$$
where,  

* $β_{j0}$is an intercept and represents the log-odds of $Y≤j$ when all the predictors are at 0 or their reference level. 
* $X_{1}$ is earthquake, $X_{2}$ is tsunami, $X_{3}$ is VEI, $X_{4}$ is elevation.
* Each $-η_{k}$ for $k = 1,2,3,4$ is the log of the odds ratio comparing the odds of $Y≤j$ between individuals who differ by 1-unit in $X_{k}$.

We'll use the `polr` command from the `MASS` package to estimate an ordered logistic regression model. We also specify `Hess=TRUE` to have the model return the observed information matrix from optimization (called the Hessian) which is used to get standard errors.

### Correlation Analysis

Before fitting the model, we need to perform a correlation analysis: if two predictors have strong correlation, we can only keep one of them in our regression model. This careful consideration ensures the avoidance of multicollinearity, thereby enhancing the precision and interpretability of our model's results.

Correlation between the variables is shown by the following heatmap:
```{r}
# Import tidied data
tidy_df = 
  read.csv2("data/volcanic-eruption-final.csv", sep = ",", stringsAsFactors = TRUE) 
  

# Select variables of interest
selected_data <- 
  tidy_df |>
  dplyr::select(flag_earthquake, flag_tsunami, volcanic_explosivity_index, elevation)

cor_matrix <- rcorr(as.matrix(selected_data), type = "spearman")

correlation_matrix <- cor_matrix$r
p_value_matrix <- cor_matrix$P
p_value_matrix[is.na(p_value_matrix)] <- 1
corrplot(correlation_matrix, p.mat = p_value_matrix, method = "color",
         tl.col = "black", tl.srt = 45, tl.offset = 0.5, tl.cex = 0.8,
         sig.level = c(0.001, 0.01, 0.05), pch.cex = 0.9, pch.col = "grey20",
         tl.pos = "lt", insig = "label_sig", type = "upper")
corrplot(correlation_matrix, type = "lower", add = TRUE, method = "number",
         tl.pos = "n", cl.pos = "n")
```

From the results of correlation analysis, we can see that there is a positive correlation between `flag_tsunami` and `flag_earthquake`. However, correlation coefficient (r) is 0.35, indicating only a moderate correlation. Therefore, we'll include both `flag_tsunami` and `flag_earthquake` in our later analysis.

We also notice that there is a negative correlation between `elevation` and `flag_tsunami`. This is probably because volcanoes under the sea are more likely to cause tsunami.

### Ordinal Logistic Regression Model

#### Fitting the Model

Having completed the correlation analysis, we can fit the following ordinal logistic regression model:

$$volcano\_deaths{\_}description \sim flag\_earthquake + flag\_tsunami + volcanic\_explosivity\_index + elevation$$

In this model, `volcano_deaths_description` is a four-level variable, with levels "Few (~1 to 50)", "Some (~51 to 100)", "Many (~101 to 1000)", "Very Many (~1001 or more)", coded 1, 2, 3, and 4  respectively, that we will use as our outcome variable. 

```{r}
death_df = 
  tidy_df |>
  mutate(volcano_deaths_description = droplevels(volcano_deaths_description, exclude = "None/No Record")) |>
  mutate(volcano_deaths_description = factor(volcano_deaths_description, levels = c("Few (~1 to 50)", "Some (~51 to 100)", "Many (~101 to 1000)", "Very Many (~1001 or more)"))) |>
  filter(volcano_deaths_description != "None/No Record")

logistic_model <- polr(volcano_deaths_description ~ flag_earthquake + flag_tsunami + volcanic_explosivity_index + elevation, data = death_df, Hess=TRUE)

## view a summary of the model
logistic_model |> broom::tidy() |> knitr::kable()
```


The estimated model can be written as:

$$logit(\hat{P}(Y≤1))=3.2838-0.4678×earthquake-1.0003×tsunami-0.6581×VEI-0.0002×elevation$$
$$logit(\hat{P}(Y≤2))=3.7736-0.4678×earthquake-1.0003×tsunami-0.6581×VEI-0.0002×elevation$$
$$logit(\hat{P}(Y≤3))=5.2650-0.4678×earthquake-1.0003×tsunami-0.6581×VEI-0.0002×elevation$$

The estimate for `elevation` appears relatively small, possibly because the unit of measurement for elevation is in meters (m). If we use kilometers (km) instead, the estimate would likely increase.

#### P-value

Some people require a p value to be satisfied. In this situation, comparing the t-value to the conventional normal distribution using a z test is one method of computing a p-value. This is only true when there are infinite degrees of freedom, but large samples can well approximate it; as sample size drops, the sample becomes more biased. This method is simple to implement and is utilized in other software programs like Stata. We compute the p-values and then merge them back with the table after storing the coefficient table.
```{r}
## store table
ctable2 <- coef(summary(logistic_model))

## calculate and store p values
p <- pnorm(abs(ctable2[, "t value"]), lower.tail = FALSE) * 2

## combined table
ctable2 <- cbind(ctable2, "p value" = p)

knitr::kable(ctable2)

```
**Interpretations**:

All the four predictors (`flag_earthquake`, `flag_tsunami`, `volcanic_explosivity_index`, `elevation`) have p-values less than 0.05, indicating that each of them is statistically significant at the 0.05 significance level.

#### Confidence Interval

We can also get confidence intervals for the parameter estimates. If the 95% CI does not cross 0, the parameter estimate is statistically significant.
```{r}
ci = confint.default(logistic_model) 

knitr::kable(ci)
```
**Interpretations**:

The CIs for all predictors (`flag_earthquake`, `flag_tsunami`, `volcanic_explosivity_index`, `elevation`) do not include 0. Therefore, the parameter estimates are statistically significant.

#### Odds Ratio

Another way to interpret logistic regression models is to convert the coefficients into odds ratios. To get the OR and confidence intervals, we just exponentiate the estimates and confidence intervals.
```{r}
exp(cbind(OR = coef(logistic_model), ci)) |> knitr::kable()
```
**Interpretation**:

* For volcano eruptions accompanied by earthquake, the odds of causing more deaths (i.e., very many, many or some versus few) is 1.60 times that of volcano eruptions that are not accompanied by earthquake, holding constant all other variables.
* For volcano eruptions accompanied by tsunami, the odds of causing more deaths (i.e., very many, many or some versus few) is 2.72 times that of volcano eruptions that are not accompanied by tsunami, holding constant all other variables.
* For every one unit increase in volcanic explosivity index (VEI), the odds of causing more deaths (i.e., very many, many or some versus few) is multiplied 1.93 times (i.e., increases 93%), holding constant all other variables.
* A one-unit increase in elevation is not associated with a change in the odds of causing more deaths.



## Discussion 

### Findings and Conclusions

By conducting exploratory data analysis, we demonstrated the geographical and temporal distribution of volcanic eruptions. We found that most volcanoes are located along the **peripheries of continents**, especially along the **Pacific Ocean**. And while eruptions before 1000 A.D. seem to have a higher VEI than those after, it could be attributed to **reporting bias** from the ancient era, in which only the most colossal volcanic eruptions were documented. We also explored the potential factors that influence the deaths, injuries, damage and houses destroyed by volcanic eruptions. From the numeric and descriptive data of volcanic losses, we got similar conclusions that the occurrence of **tsunami** and **earthquake** and the **VEI** of the eruption are **positively associated** with volcanic losses. While there is a potential relationship between the **elevation** of a volcano and the deaths caused by its eruption, this association is not very significant and does not appear in other types of losses, hence requires further analysis.

For the statistical analysis, we chose **ordinal logistic regression** to assess the association between our predictors (tsunami, earthquake, VEI and elevation) and ordinal outcome (severity level of deaths). We performed a correlation analysis and found that there is **no strong multicollinearity**, so we included all the predictors and fit the following ordinal logistic regression model: $volcano\_deaths{\_}description \sim flag\_earthquake + flag\_tsunami + volcanic\_explosivity\_index + elevation$. 

We calculated the p-values and CIs for the coefficient estimates, suggesting **significance** for all four predictors. Therefore, we calculated the odds ratios and drew the following conclusions about the factors influencing volcanic deaths:

* For volcano eruptions accompanied by **earthquake**, the odds of causing more deaths (i.e., very many, many or some versus few) is **1.60 times** that of volcano eruptions without earthquake, holding constant all other variables.
* For volcano eruptions accompanied by **tsunami**, the odds of causing more deaths (i.e., very many, many or some versus few) is **2.72 times** that of volcano eruptions without tsunami, holding constant all other variables.
* For every one unit increase in volcanic explosivity index (**VEI**), the odds of causing more deaths (i.e., very many, many or some versus few) is multiplied **1.93 times** (i.e., increases 93%), holding constant all other variables.
* A one-unit (1 meter) increase in **elevation** is not associated with a change in the odds of causing more deaths, but a **large increase** (e.g. > 1000 meters) in elevation may be associated with higher odds of causing more deaths.

### Limitations

While our study provides some insights into volcanic eruptions, it is worth noting that there are still many limitations to be recognized, including but not limited to the following.

* **Data quality**: The dataset we use contains records of volcanic eruptions from over 4000 B.C. to 2020 A.D., but the data quality is likely to be inconsistent over the years. For example, as mentioned in the analysis of time distribution, people in ancient era may have documented only the most colossal volcanic eruptions. The bar chart of eruptions over time periods also supports this, as the number of recorded eruptions increases dramatically after 1500 A.D. compared to before 1500 A.D. Therefore, our study may not be able to accurately reflect the true characteristics of volcanic eruptions over the time span.

* **Data selection**: When analyzing factors influencing the severity of volcanic losses, we filtered out the "None/No record" values and focused only on the eruptions with losses recorded. However, this may introduce bias to our analysis, as the "None/No record" records makes up a large part of the data, and by removing them, we ignored the factors' influence on eruptions with no loss, as well as the eruptions that actually caused losses but were not recorded.

* **Model generalizability**: Finally, it is debatable whether our model derived from the death severity level data can be generalized to other type of volcanic losses. For instance, in exploratory analysis, we found that the elevation of the volcano may be associated with deaths, but not other types of losses. This suggests that the model may need adjustments when dealing with a different type of outcome, and further statistical analysis is needed.
