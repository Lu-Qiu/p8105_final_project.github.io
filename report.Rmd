---
title: "Project Report"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: "hide"
---

```{r setup, include=FALSE}
library(tidyverse)
library(leaflet)
library(cowplot)
library(gridExtra)

# set knitr defaults
knitr::opts_chunk$set(
  echo = TRUE, 
  message = FALSE, 
  warning = FALSE,
  fig.width = 9
)

# set theme defaults
theme_set(theme_minimal() + theme(legend.position = "bottom"))

# set color scale defaults
options(
    ggplot2.continuous.colour = "viridis",
    ggplot2.continuous.fill   = "viridis")

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete   = scale_fill_viridis_d
```

### Motivation

Recently, a striking news about the potential volcano eruption in Iceland caught our attention. Motivated by the need to better understand and analyze the impact of such natural phenomena, we aim to delve into the patterns, trends, and factors surrounding volcanic eruptions, utilizing data science techniques to extract meaningful insights.

### Related work

Caldera J, Wirasinghe S C. Analysis and classification of volcanic eruptions[J]. 2014.

### Initial questions

* What are the characteristics and patterns of volcanic eruptions?

* What are the main factors that influence the losses (e.g. casualties, economic damage) caused by a volcanic eruption?

### Data

#### Data Source

We use the [Significant Volcanic Eruption Database](https://public.opendatasoft.com/explore/dataset/significant-volcanic-eruption-database/information/) in our study. The original csv file can be downloaded at the linked website.

#### Data Cleaning

```{r}
tidy_df = 
  read.csv(
    "data/significant-volcanic-eruption-database.csv", 
    sep = ";", na.strings=c("", NA)) |>
  janitor::clean_names() |>
  select(
    -c(month, day, location, status, volcano_missing, volcano_missing_description, earthquakes_houses_damaged_description),
    -starts_with("total")
    ) |>
  mutate( # change flags to boolean
    flag_tsunami = case_match(flag_tsunami, "Tsunami"~ TRUE, NA ~ FALSE),
    flag_earthquake = case_match(flag_earthquake, "Earthquake"~ TRUE, NA ~ FALSE)
  ) |>
  separate(coordinates, into = c("lat", "long"), sep = ",") |>
  mutate(
    lat = as.numeric(lat), long = as.numeric(long)
  ) |>
  mutate_at(vars(ends_with('description')), ~ifelse(is.na(.), "None/No Record", .)) |>
  mutate( # shorten description
    volcano_deaths_description = case_match(
      volcano_deaths_description,
      "Very Many (~1001 or more deaths)" ~ "Very Many (~1001 or more)", 
      "Many (~101 to 1000 deaths)" ~ "Many (~101 to 1000)", 
      "Some (~51 to 100 deaths)" ~ "Some (~51 to 100)", 
      "Few (~1 to 50 deaths)" ~ "Few (~1 to 50)",
      "None/No Record" ~ "None/No Record"
    ),
    volcano_injuries_description = case_match(
      volcano_injuries_description,
      "Very Many (~1001 or more deaths)" ~ "Very Many (~1001 or more)", 
      "Many (~101 to 1000 deaths)" ~ "Many (~101 to 1000)", 
      "Some (~51 to 100 deaths)" ~ "Some (~51 to 100)", 
      "Few (~1 to 50 deaths)" ~ "Few (~1 to 50)",
      "None/No Record" ~ "None/No Record"
    ),
    volcano_damage_description = case_match(
      volcano_damage_description,
      "EXTREME (~$25 million or more)" ~ "EXTREME (~>=$25 million)", 
      "SEVERE (~>$5 to $24 million)" ~ "SEVERE (~$5 to $24 million)", 
      "MODERATE (~$1 to $5 million)" ~ "MODERATE (~$1 to $5 million)", 
      "LIMITED (roughly corresponding to less than $1 million)" ~ "LIMITED (~<$1 million)",
      "None/No Record" ~ "None/No Record"
    ),
    volcano_houses_destroyed_description = case_match(
      volcano_houses_destroyed_description,
      "Very Many (~1001 or more houses)" ~ "Very Many (~1001 or more)", 
      "Many (~101 to 1000 houses)" ~ "Many (~101 to 1000)", 
      "Some (~51 to 100 houses)" ~ "Some (~51 to 100)", 
      "Few (~1 to 50 houses)" ~ "Few (~1 to 50)",
      "None/No Record" ~ "None/No Record"
    )
  ) |>
  mutate( # change descriptions to factors w/ levels
    volcano_deaths_description = factor(volcano_deaths_description, levels = c("Very Many (~1001 or more)", "Many (~101 to 1000)", "Some (~51 to 100)", "Few (~1 to 50)", "None/No Record")),
    volcano_injuries_description = factor(volcano_injuries_description, levels = c("Very Many (~1001 or more)", "Many (~101 to 1000)", "Some (~51 to 100)", "Few (~1 to 50)", "None/No Record")),
    volcano_damage_description = factor(volcano_damage_description, levels = c("EXTREME (~>=$25 million)", "SEVERE (~$5 to $24 million)", "MODERATE (~$1 to $5 million)", "LIMITED (~<$1 million)", "None/No Record")),
    volcano_houses_destroyed_description = factor(volcano_houses_destroyed_description, levels = c("Very Many (~1001 or more)", "Many (~101 to 1000)", "Some (~51 to 100)", "Few (~1 to 50)", "None/No Record"))
  )

```

The raw data is a global listing of over 800 volcanic eruptions and their information. All the variables are compressed in two columns in the csv file, so when importing the data, we used `read.csv()` function to separate them by `;`, and set the empty values as `NA`.

Next, we cleaned the variable names with `janitor::clean_names()`, and removed the unwanted variables (e.g. `month` and `day` which are missing for many eruptions, `location` which is unnecessary in our study, variables of total effect which are mostly repetition of volcano  effect) from our dataframe.

Finally, we used `mutate()` function to make some necessary adjustments to the variables, including:

* Changed the variable type of `flag_tsunami` and `flag_earthquake` from character to boolean using `case_match()`.

* Separated variable `coordinates` into two numeric variables `lat`, `long` using `separate()` and `as.numeric()`.

* For the loss description variables, changed the `NA` values to `"None/No Record"`, shortened the description length using `case_match()` and changed their type from character to factor using `factor()`, assigning the levels according to severity.

The final dataframe used for the analysis, `tidy_df`,  has __18__ variables, listed below:

* `year`: the year of eruption
* `flag_tsunami`: whether there is a tsunami accompanying the volcanic eruption
* `flag_earthquake`: whether there is an earthquake accompanying the volcanic eruption
* `volcano_name`: the name of the volcano
* `country`: the country where the volcano is located
* `elevation`: the elevation of the volcano
* `volcano_type`: the type of the volcano
* `volcanic_explosivity_index`: VEI          
* `volcano_deaths`: number of deaths caused by the eruption
* `volcano_deaths_description`: severity level of deaths
* `volcano_injuries`: number of injuries caused by the eruption                    
* `volcano_injuries_description`: severity level of injuries
* `volcano_damage_in_m`: economic damage in million caused by the eruption             
* `volcano_damage_description`: severity level of economic damage
* `volcano_houses_destroyed`: number of houses destroyed by the eruption             
* `volcano_houses_destroyed_description`: severity level of house destruction
* `lat`: latitude of the volcano                                 
* `long`: longitude of the volcano

### Exploratory analysis
Visualizations, summaries, and exploratory statistical analyses. Justify the steps you took, and show any major changes to your ideas.

### Additional analysis
If you undertake formal statistical analyses, describe these in detail

### Discussion 
What were your findings? Are they what you expect? What insights into the data can you make?